#!/bin/bash

# Create directory for Pokémon data
mkdir -p pokemon_data

# Function to fetch Pokémon data
fetch_pokemon() {
    pokemon=$1
    echo "Fetching data for ${pokemon}..."
    
    curl -s --max-time 10 "https://pokeapi.co/api/v2/pokemon/${pokemon}" -o "pokemon_data/${pokemon}.json"
    
    if [ $? -eq 0 ] && [ -s "pokemon_data/${pokemon}.json" ]; then
        echo "Saved data to pokemon_data/${pokemon}.json"
        return 0
    else
        echo "Failed to fetch data for ${pokemon}"
        return 1
    fi
}

# List of Pokémon to fetch
pokemon_list=("bulbasaur" "ivysaur" "venusaur" "charmander" "charmeleon")

# Start background processes for each Pokémon
for pokemon in "${pokemon_list[@]}"; do
    fetch_pokemon "$pokemon" &
done

# Use jobs to check background processes
echo "Started all background jobs. Waiting for completion..."

# Wait for all background jobs to complete
wait

echo "All Pokémon data fetched successfully!"

# Check if any jobs are still running (should be none)
if jobs -r | grep -q .; then
    echo "Warning: Some jobs still running"
    # Kill any remaining jobs if needed
    jobs -p | xargs kill -9 2>/dev/null
fi
